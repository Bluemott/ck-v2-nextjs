version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "üöÄ Production-Ready Amplify Build"
        - echo "Node: $(node --version) | npm: $(npm --version)"
        - echo "Setting environment variables..."
        # Core environment setup
        - export NODE_ENV=production
        - export NEXT_PUBLIC_USE_AWS_GRAPHQL=false
        - export NEXT_PUBLIC_SITE_URL=${NEXT_PUBLIC_SITE_URL:-https://cowboykimono.com}
        - export NEXT_PUBLIC_WPGRAPHQL_URL=${NEXT_PUBLIC_WPGRAPHQL_URL:-https://api.cowboykimono.com/graphql}
        # Install dependencies with error handling
        - echo "üì¶ Installing dependencies..."
        - npm ci --legacy-peer-deps --no-optional --prefer-offline || npm install --legacy-peer-deps --no-optional
        - echo "‚úÖ Dependencies installed"
        # Optional type checking (non-blocking)
        - echo "üîç Checking types..."
        - npm run type-check || echo "‚ö†Ô∏è  Type check completed with warnings"
    build:
      commands:
        - echo "üî® Building application..."
        - export NODE_ENV=production
        - npm run build
        - echo "‚úÖ Build successful"
        - echo "üìÅ Artifacts ready:"
        - ls -la .next
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*