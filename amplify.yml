version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸš€ Starting Amplify build process..."
        - echo "ğŸ“‹ Build environment info:"
        - 'echo "   - AWS_REGION: ${AWS_REGION:-us-east-1}"'
        - echo "   - NODE_ENV: production"
        - 'echo "   - Build ID: $CODEBUILD_BUILD_ID"'
        - echo ""
        - echo "ğŸ”§ Setting up build environment..."
        - export NODE_ENV=production
        - export NEXT_TELEMETRY_DISABLED=1
        - 'export AWS_REGION=${AWS_REGION:-us-east-1}'
        - echo "âœ… Environment variables set"
        - echo ""
        - echo "ğŸ“¦ Installing dependencies..."
        - npm ci --legacy-peer-deps --no-optional --silent
        - echo "âœ… Dependencies installed successfully"
    build:
      commands:
        - echo "ğŸ—ï¸  Building Next.js application..."
        - echo "ğŸ“Š Build configuration:"
        - 'echo "   - TypeScript: ignoreBuildErrors=true"'
        - 'echo "   - ESLint: ignoreDuringBuilds=true"'
        - 'echo "   - Output: .next directory"'
        - echo ""
        - npm run build
        - echo "âœ… Build completed successfully"
        - echo ""
        - echo "ğŸ“ Build artifacts:"
        - ls -la .next/
        - echo ""
        - echo "ğŸ‰ Build process completed!"
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
  customHeaders:
    - pattern: '**/*'
      headers:
        - key: 'Cache-Control'
          value: 'public, max-age=31536000, immutable'
        - key: 'X-Content-Type-Options'
          value: 'nosniff'
        - key: 'X-Frame-Options'
          value: 'DENY'
        - key: 'X-XSS-Protection'
          value: '"1; mode=block"' 